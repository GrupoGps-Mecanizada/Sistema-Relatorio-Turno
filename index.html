<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Relat√≥rio de Turno - GrupoGPS v4.0</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .login-container {
            background: var(--white);
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            max-width: 450px;
            width: 90%;
            text-align: center;
        }

        .login-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--gray-900);
        }

        .login-subtitle {
            color: var(--gray-600);
            margin-bottom: 2rem;
            font-size: 1rem;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            text-align: left;
        }

        .form-label {
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
            background: var(--white);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            background: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-sm { padding: 0.5rem 1rem; font-size: 0.875rem; }
        .btn-lg { padding: 1.25rem 2rem; font-size: 1.125rem; }
        .btn-secondary { background: var(--secondary-color); }
        .btn-secondary:hover { background: var(--gray-700); }
        .btn-success { background: var(--success-color); }
        .btn-success:hover { background: #059669; }
        .btn-warning { background: var(--warning-color); }
        .btn-warning:hover { background: #d97706; }
        .btn-danger { background: var(--danger-color); }
        .btn-danger:hover { background: #dc2626; }
        .btn-info { background: var(--info-color); }
        .btn-info:hover { background: #2563eb; }

        /* Header */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--gray-50);
            border-radius: 8px;
            font-weight: 500;
            color: var(--gray-700);
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .sync-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success-color);
        }

        .sync-dot.loading {
            background: var(--warning-color);
            animation: pulse 2s infinite;
        }

        .sync-dot.error {
            background: var(--danger-color);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Navigation */
        .nav-tabs {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            overflow-x: auto;
        }

        .nav-tabs-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
        }

        .nav-tab {
            padding: 1rem 2rem;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-600);
            transition: all 0.2s;
            white-space: nowrap;
            font-size: 0.95rem;
        }

        .nav-tab:hover {
            color: var(--primary-color);
            background: var(--gray-50);
        }

        .nav-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: var(--gray-50);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .card-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            background: var(--gray-50);
        }

        .card-title {
            font-weight: 700;
            color: var(--gray-900);
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-content {
            padding: 2rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-color);
        }

        .stat-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
            justify-content: center;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .step-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            background: var(--gray-100);
            border-radius: 8px;
            color: var(--gray-500);
            font-weight: 600;
            transition: all 0.3s;
        }

        .step-item.active {
            background: var(--primary-color);
            color: var(--white);
            transform: scale(1.05);
        }

        .step-item.completed {
            background: var(--success-color);
            color: var(--white);
        }

        .step-number {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background: var(--white);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .step-item.active .step-number {
            background: var(--white);
            color: var(--primary-color);
        }

        .step-item.completed .step-number {
            background: var(--white);
            color: var(--success-color);
        }

        /* Team Cards */
        .teams-container {
            display: grid;
            gap: 1.5rem;
        }

        .team-card {
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .team-card.alta-pressao {
            border-left: 4px solid var(--success-color);
        }

        .team-card.vacuo {
            border-left: 4px solid var(--danger-color);
        }

        .team-header {
            padding: 1.5rem;
            background: var(--gray-50);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-info h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .team-info p {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .team-content {
            padding: 1.5rem;
        }

        .team-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .detail-item {
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 8px;
        }

        .detail-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-weight: 600;
            color: var(--gray-900);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
        }

        .modal.show {
            display: flex !important;
        }

        .modal-content {
            background: var(--white);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            max-height: 95vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .modal-header {
            padding: 2rem 2rem 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--gray-400);
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            color: var(--gray-600);
            background: var(--gray-100);
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            padding: 1rem 2rem 2rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            background: var(--white);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.875rem;
        }

        .data-table th {
            background: var(--gray-50);
            font-weight: 600;
            color: var(--gray-900);
            position: sticky;
            top: 0;
        }

        .data-table tr:hover {
            background: var(--gray-50);
        }

        /* Badge */
        .badge {
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-primary { background: rgba(37, 99, 235, 0.1); color: var(--primary-color); }
        .badge-success { background: rgba(16, 185, 129, 0.1); color: var(--success-color); }
        .badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning-color); }
        .badge-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger-color); }
        .badge-info { background: rgba(59, 130, 246, 0.1); color: var(--info-color); }
        .badge-secondary { background: rgba(100, 116, 139, 0.1); color: var(--secondary-color); }

        /* Notifications */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: var(--white);
            font-weight: 600;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 10000;
            max-width: 400px;
            animation: slideInRight 0.3s ease-out;
        }

        .notification.success { background: var(--success-color); }
        .notification.error { background: var(--danger-color); }
        .notification.warning { background: var(--warning-color); }
        .notification.info { background: var(--info-color); }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            background: var(--white);
            padding: 3rem;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .loading-spinner {
            width: 3rem;
            height: 3rem;
            border: 3px solid var(--gray-300);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--gray-700);
            font-weight: 600;
        }

        /* Report View */
        .report-container {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 2rem;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            line-height: 1.5;
            max-height: 600px;
            overflow-y: auto;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .header-controls {
                width: 100%;
                justify-content: space-between;
            }

            .main-content {
                padding: 1rem;
            }

            .nav-tab {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .form-actions {
                flex-direction: column;
            }

            .card-header {
                flex-direction: column;
                align-items: stretch;
            }

            .step-indicator {
                flex-direction: column;
            }

            .team-details {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 0.5rem;
            }

            .login-container {
                padding: 2rem;
            }
        }

        .hidden { display: none !important; }
        .show { display: block !important; }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--gray-700);
        }

        .empty-state p {
            font-size: 0.875rem;
        }

        /* Select Styles */
        .form-select {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
            background: var(--white);
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 3rem;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Textarea */
        .form-textarea {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
            background: var(--white);
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Radio and Checkbox */
        .form-radio,
        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .form-radio input,
        .form-checkbox input {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--primary-color);
        }

        /* Success Animation */
        .success-animation {
            text-align: center;
            padding: 3rem;
        }

        .success-icon {
            font-size: 4rem;
            color: var(--success-color);
            margin-bottom: 1rem;
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <h1 class="login-title">üìã Sistema de Relat√≥rio de Turno</h1>
            <p class="login-subtitle">GrupoGPS - Acesso Seguro v4.0</p>
            
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">Usu√°rio</label>
                    <input type="text" id="loginUser" class="form-input" placeholder="Digite seu usu√°rio" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Senha</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="Digite sua senha" required>
                </div>
                
                <button type="submit" class="btn">
                    üîê Entrar no Sistema
                </button>
            </form>
            
            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--gray-200); font-size: 0.875rem; color: var(--gray-500);">
                <strong>Usu√°rios padr√£o:</strong><br>
                admin / 123456 (Administrador)<br>
                supervisor / 123 (Supervisor)<br>
                setup / gps@2025 (Configura√ß√£o)
            </div>
        </div>
    </div>

    <div class="app-container" id="appContainer" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-brand">
                    üìã Sistema de Relat√≥rio de Turno
                    <span style="font-size: 0.875rem; font-weight: 400; color: var(--gray-500);">v4.0</span>
                </div>
                
                <div class="header-controls">
                    <div class="user-info">
                        üë§ <span id="currentUser">Usu√°rio</span>
                        <span id="userLevel" class="badge badge-primary"></span>
                    </div>
                    
                    <div class="sync-status">
                        <div class="sync-dot" id="syncDot"></div>
                        <span id="syncStatus">Conectando...</span>
                    </div>
                    
                    <button class="btn btn-sm btn-info" onclick="forceRefresh()">
                        üîÑ Atualizar
                    </button>
                    
                    <button class="btn btn-danger btn-sm" onclick="logout()">
                        üö™ Sair
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <div class="nav-tabs-container">
                <div class="nav-tab active" onclick="switchTab('novo-relatorio')">
                    üìù Novo Relat√≥rio
                </div>
                <div class="nav-tab" onclick="switchTab('relatorios')">
                    üìä Relat√≥rios
                </div>
                <div class="nav-tab" onclick="switchTab('pesquisa')">
                    üîç Pesquisar
                </div>
                <div class="nav-tab" onclick="switchTab('dashboard')">
                    üìà Dashboard
                </div>
                <div class="nav-tab" onclick="switchTab('configuracoes')">
                    ‚öôÔ∏è Configura√ß√µes
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Novo Relat√≥rio Tab -->
            <div id="novo-relatorio-tab" class="tab-content active">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step-item active" id="step1">
                        <div class="step-number">1</div>
                        <span>Informa√ß√µes do Turno</span>
                    </div>
                    <div class="step-item" id="step2">
                        <div class="step-number">2</div>
                        <span>Equipes</span>
                    </div>
                    <div class="step-item" id="step3">
                        <div class="step-number">3</div>
                        <span>Revis√£o</span>
                    </div>
                </div>

                <!-- Etapa 1: Informa√ß√µes do Turno -->
                <div id="etapa1" class="step-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üìÖ Informa√ß√µes B√°sicas do Turno</h2>
                        </div>
                        <div class="card-content">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Data do Turno *</label>
                                    <input type="date" id="dataTurno" class="form-input" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Hor√°rio do Turno *</label>
                                    <select id="horarioTurno" class="form-select" required>
                                        <option value="">Selecione o hor√°rio...</option>
                                        <option value="07:00 - 19:00">07:00 - 19:00</option>
                                        <option value="19:00 - 07:00">19:00 - 07:00</option>
                                        <option value="ADM">ADM</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Letra do Turno *</label>
                                    <select id="letraTurno" class="form-select" required>
                                        <option value="">Selecione a letra...</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Supervisor Respons√°vel *</label>
                                    <select id="supervisorTurno" class="form-select" required>
                                        <option value="">Selecione o supervisor...</option>
                                        <option value="Ozias">Ozias</option>
                                        <option value="Israel">Israel</option>
                                        <option value="Junior Pereira">Junior Pereira</option>
                                        <option value="Donizete">Donizete</option>
                                        <option value="Sebasti√£o Ribeiro">Sebasti√£o Ribeiro</option>
                                        <option value="Jenessi">Jenessi</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-lg" onclick="nextStep()">
                                    Pr√≥ximo: Adicionar Equipes ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Etapa 2: Equipes -->
                <div id="etapa2" class="step-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üë• Detalhes das Equipes</h2>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-success" onclick="adicionarEquipe('Alta Press√£o')">
                                    ‚ûï Alta Press√£o
                                </button>
                                <button class="btn btn-danger" onclick="adicionarEquipe('Auto V√°cuo / Hiper V√°cuo')">
                                    ‚ûï V√°cuo/Hiper
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="teams-container" id="teamsContainer">
                                <div class="empty-state">
                                    <div class="empty-state-icon">üë•</div>
                                    <h3>Nenhuma equipe adicionada</h3>
                                    <p>Clique nos bot√µes acima para adicionar equipes ao relat√≥rio</p>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary btn-lg" onclick="prevStep()">
                                    ‚Üê Voltar
                                </button>
                                <button type="button" class="btn btn-lg" onclick="nextStep()" id="btnProximoRevisao" disabled>
                                    Pr√≥ximo: Revis√£o ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Etapa 3: Revis√£o -->
                <div id="etapa3" class="step-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">‚úÖ Revis√£o e Finaliza√ß√£o</h2>
                        </div>
                        <div class="card-content">
                            <div class="card" style="margin-bottom: 2rem;">
                                <div class="card-header">
                                    <h3 class="card-title">üìã Resumo do Turno</h3>
                                </div>
                                <div class="card-content">
                                    <div id="resumoTurno" class="form-grid">
                                        <!-- Preenchido via JavaScript -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">üë• Resumo das Equipes</h3>
                                </div>
                                <div class="card-content">
                                    <div id="resumoEquipes">
                                        <!-- Preenchido via JavaScript -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary btn-lg" onclick="prevStep()">
                                    ‚Üê Voltar
                                </button>
                                <button type="button" class="btn btn-success btn-lg" onclick="salvarRelatorio()">
                                    üíæ Salvar Relat√≥rio
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Etapa 4: Sucesso -->
                <div id="etapa4" class="step-content" style="display: none;">
                    <div class="card">
                        <div class="card-content">
                            <div class="success-animation">
                                <div class="success-icon">‚úÖ</div>
                                <h2 style="color: var(--success-color); margin-bottom: 1rem;">Relat√≥rio Salvo com Sucesso!</h2>
                                <p style="color: var(--gray-600); margin-bottom: 2rem;">
                                    Relat√≥rio <strong id="relatorioIdDisplay"></strong> foi registrado no sistema.
                                </p>
                                
                                <div class="form-actions">
                                    <button class="btn btn-primary btn-lg" onclick="visualizarRelatorio()">
                                        üëÅÔ∏è Visualizar Relat√≥rio
                                    </button>
                                    <button class="btn btn-success btn-lg" onclick="formatarWhatsApp()">
                                        üì± Formato WhatsApp
                                    </button>
                                    <button class="btn btn-secondary" onclick="novoRelatorio()">
                                        üìù Novo Relat√≥rio
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Relat√≥rios Tab -->
            <div id="relatorios-tab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalRelatorios">0</div>
                        <div class="stat-label">Total de Relat√≥rios</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="relatoriosHoje">0</div>
                        <div class="stat-label">Relat√≥rios Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="equipesTotal">0</div>
                        <div class="stat-label">Total de Equipes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="atividadesConcluidas">0</div>
                        <div class="stat-label">Atividades Conclu√≠das</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìä Relat√≥rios Registrados</h3>
                        <button class="btn btn-success" onclick="exportarRelatorios()">
                            üì• Exportar Excel
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="table-container">
                            <table class="data-table" id="tabelaRelatorios">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Data</th>
                                        <th>Hor√°rio</th>
                                        <th>Letra</th>
                                        <th>Supervisor</th>
                                        <th>Equipes</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="relatoriosTableBody">
                                    <tr>
                                        <td colspan="8">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">üìã</div>
                                                <h3>Nenhum relat√≥rio encontrado</h3>
                                                <p>Crie seu primeiro relat√≥rio na aba "Novo Relat√≥rio"</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pesquisa Tab -->
            <div id="pesquisa-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üîç Pesquisar Relat√≥rios</h3>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Pesquisar por</label>
                                <select id="tipoPesquisa" class="form-select" onchange="ajustarCampoPesquisa()">
                                    <option value="geral">Termo Geral ou ID</option>
                                    <option value="data">Data Espec√≠fica</option>
                                    <option value="periodo">Per√≠odo</option>
                                    <option value="supervisor">Supervisor</option>
                                    <option value="letra">Letra do Turno</option>
                                </select>
                            </div>
                            
                            <div class="form-group" id="campoPesquisaGeral">
                                <label class="form-label">Termo de Pesquisa</label>
                                <input type="text" id="termoPesquisa" class="form-input" placeholder="Digite ID ou termo geral">
                            </div>
                            
                            <div class="form-group hidden" id="campoPesquisaData">
                                <label class="form-label">Data</label>
                                <input type="date" id="dataPesquisa" class="form-input">
                            </div>
                            
                            <div class="form-group hidden" id="campoPesquisaPeriodo">
                                <label class="form-label">Data Inicial</label>
                                <input type="date" id="dataInicialPesquisa" class="form-input">
                            </div>
                            
                            <div class="form-group hidden" id="campoPesquisaPeriodoFim">
                                <label class="form-label">Data Final</label>
                                <input type="date" id="dataFinalPesquisa" class="form-input">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-primary btn-lg" onclick="executarPesquisa()">
                                üîç Pesquisar
                            </button>
                            <button class="btn btn-secondary" onclick="limparPesquisa()">
                                üóëÔ∏è Limpar
                            </button>
                        </div>
                        
                        <div id="resultadosPesquisa" class="hidden" style="margin-top: 2rem;">
                            <h4 style="margin-bottom: 1rem;">Resultados da Pesquisa</h4>
                            <div class="table-container">
                                <table class="data-table" id="tabelaPesquisa">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Data</th>
                                            <th>Hor√°rio</th>
                                            <th>Letra</th>
                                            <th>Supervisor</th>
                                            <th>Equipes</th>
                                            <th>A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pesquisaTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="dashTotalRelatorios">0</div>
                        <div class="stat-label">Total de Relat√≥rios</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="dashEquipesAtivas">0</div>
                        <div class="stat-label">Equipes Ativas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="dashAtividadesConcluidas">0</div>
                        <div class="stat-label">Atividades Conclu√≠das</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="dashTrocasEquipamento">0</div>
                        <div class="stat-label">Trocas de Equipamento</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üìà Relat√≥rios por Per√≠odo</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="graficoRelatorios" width="400" height="200"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">üë• Tipos de Equipe</h3>
                        </div>
                        <div class="card-content">
                            <canvas id="graficoEquipes" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã √öltimos Relat√≥rios</h3>
                    </div>
                    <div class="card-content">
                        <div id="ultimosRelatorios">
                            <!-- Preenchido via JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configura√ß√µes Tab -->
            <div id="configuracoes-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">‚öôÔ∏è Configura√ß√µes do Sistema</h3>
                    </div>
                    <div class="card-content">
                        <!-- GitHub Configuration -->
                        <div class="card" style="margin-bottom: 2rem;">
                            <div class="card-header">
                                <h4 class="card-title">üêô Configura√ß√µes GitHub</h4>
                            </div>
                            <div class="card-content">
                                <div id="setupInstruction" class="hidden" style="padding: 1rem; margin-bottom: 1rem; background-color: var(--warning-color); color: var(--white); border-radius: 8px;">
                                    <strong>‚ö†Ô∏è Modo de Configura√ß√£o Ativado</strong><br>
                                    1. Insira seu Token de Acesso do GitHub e clique em "Salvar".<br>
                                    2. Clique em "Inicializar Sistema" para criar os arquivos no seu reposit√≥rio.<br>
                                    3. Ap√≥s a confirma√ß√£o, recarregue a p√°gina para usar o sistema normalmente.
                                </div>

                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Token de Acesso GitHub</label>
                                        <input type="password" id="githubToken" class="form-input" 
                                               placeholder="GitHub Personal Access Token">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Reposit√≥rio</label>
                                        <input type="text" id="githubRepo" class="form-input" 
                                               value="GrupoGps-Mecanizada/Sistema-Relatorio-Turno" readonly>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-info" onclick="testarConexaoGitHub()">
                                        üîç Testar Conex√£o
                                    </button>
                                    <button class="btn btn-success" onclick="salvarConfigGitHub()">
                                        üíæ Salvar Configura√ß√µes
                                    </button>
                                    <button class="btn btn-warning hidden" id="btnInitializeSystem" onclick="initializeSystemFiles()">
                                        üöÄ Inicializar Sistema
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- General Settings -->
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">üõ†Ô∏è Configura√ß√µes Gerais</h4>
                            </div>
                            <div class="card-content">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Nome da Empresa</label>
                                        <input type="text" id="nomeEmpresa" class="form-input" value="GrupoGPS">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Atualiza√ß√£o Autom√°tica (segundos)</label>
                                        <input type="number" id="autoRefreshInterval" class="form-input" value="60" min="30">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Backup Autom√°tico</label>
                                        <select id="autoBackup" class="form-select">
                                            <option value="true">Ativado</option>
                                            <option value="false">Desativado</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-success" onclick="salvarConfigGerais()">
                                        üíæ Salvar Configura√ß√µes
                                    </button>
                                    <button class="btn btn-danger" onclick="resetarSistema()">
                                        üîÑ Resetar Sistema
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer style="background: var(--white); border-top: 1px solid var(--gray-200); padding: 1.5rem; text-align: center; color: var(--gray-600);">
            <p>Desenvolvido com ‚ù§Ô∏è por <strong style="color: var(--primary-color);">Warlison Abreu</strong> | ¬© 2025 GrupoGPS - Sistema de Relat√≥rio de Turno v4.0</p>
        </footer>
    </div>

    <!-- Modal Adicionar/Editar Equipe -->
    <div class="modal" id="modalEquipe">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalEquipeTitle">Adicionar Equipe</h3>
                <button class="modal-close" onclick="closeModal('modalEquipe')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formEquipe" onsubmit="salvarEquipe(event)">
                    <input type="hidden" id="equipeIndex" value="-1">
                    <input type="hidden" id="equipeTipo" value="">

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <!-- Coluna Esquerda: Informa√ß√µes Gerais -->
                        <div>
                            <h4 style="margin-bottom: 1rem; color: var(--primary-color);">üë• Informa√ß√µes da Equipe</h4>
                            
                            <div class="form-group">
                                <label class="form-label">N√∫mero/Nome da Equipe *</label>
                                <select id="equipeNumero" class="form-select" required>
                                    <option value="">Selecione...</option>
                                    <!-- Preenchido via JavaScript -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Motorista *</label>
                                <input type="text" id="equipeMotorista" class="form-input" required placeholder="Nome do motorista">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Operador(es) *</label>
                                <textarea id="equipeOperadores" class="form-textarea" required placeholder="Nome dos operadores"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">√Årea de Atua√ß√£o *</label>
                                <input type="text" id="equipeArea" class="form-input" required placeholder="Ex: Galp√£o X, Linha Y...">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Atividade Principal *</label>
                                <input type="text" id="equipeAtividade" class="form-input" required placeholder="Ex: Limpeza de caixa, Desobstru√ß√£o...">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Tipo de Atividade *</label>
                                <select id="equipeTipoAtividade" class="form-select" required>
                                    <option value="Rotineira">üîÑ Rotineira</option>
                                    <option value="Emergencial">‚ö° Emergencial</option>
                                    <option value="Programada">üìÖ Programada</option>
                                    <option value="Preventiva">üõ†Ô∏è Preventiva</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Status da Atividade *</label>
                                <select id="equipeStatusAtividade" class="form-select" required onchange="togglePendencia()">
                                    <option value="Conclu√≠do">‚úÖ Conclu√≠do (100%)</option>
                                    <option value="Em andamento">üîÑ Em andamento</option>
                                    <option value="N√£o Iniciado">‚è∏Ô∏è N√£o Iniciado</option>
                                </select>
                            </div>
                            
                            <div class="form-group hidden" id="pendenciaContainer">
                                <label class="form-label">Justificativa/Pend√™ncia *</label>
                                <textarea id="equipePendencia" class="form-textarea" placeholder="Informe o motivo da pend√™ncia ou n√£o in√≠cio"></textarea>
                            </div>
                        </div>

                        <!-- Coluna Direita: Equipamentos e Status -->
                        <div>
                            <h4 style="margin-bottom: 1rem; color: var(--primary-color);">üöõ Equipamentos e Status</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Vaga (Parte Di√°ria) *</label>
                                <select id="equipeVaga" class="form-select" required>
                                    <option value="">Selecione a vaga...</option>
                                    <!-- Preenchido via JavaScript -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Equipamento *</label>
                                <select id="equipeEquipamento" class="form-select" required>
                                    <option value="">Selecione o equipamento...</option>
                                    <!-- Preenchido via JavaScript -->
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Identifica√ß√£o Usiminas</label>
                                <input type="text" id="equipeIdentificacaoUsiminas" class="form-input" placeholder="N¬∫ Ordem / Tag / etc. (Opcional)">
                            </div>
                            
                            <!-- Status do Equipamento -->
                            <h5 style="margin: 1.5rem 0 1rem; color: var(--secondary-color);">üîß Status do Equipamento</h5>
                            
                            <div class="form-group">
                                <label class="form-label">Houve troca de equipamento?</label>
                                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                                    <div class="form-radio">
                                        <input type="radio" name="equipeTroca" id="equipeTrocaSim" value="Sim" onchange="toggleTrocaEquipamento()">
                                        <label for="equipeTrocaSim">‚úÖ Sim</label>
                                    </div>
                                    <div class="form-radio">
                                        <input type="radio" name="equipeTroca" id="equipeTrocaNao" value="N√£o" checked onchange="toggleTrocaEquipamento()">
                                        <label for="equipeTrocaNao">‚ùå N√£o</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="trocaDetalhes" class="hidden" style="padding: 1.5rem; background: var(--gray-50); border-radius: 8px; margin-top: 1rem;">
                                <h6 style="margin-bottom: 1rem; color: var(--warning-color);">‚ö†Ô∏è Detalhes da Troca</h6>
                                
                                <div class="form-group">
                                    <label class="form-label">Motivo *</label>
                                    <select id="equipeMotivoTroca" class="form-select">
                                        <option value="">Selecione o motivo...</option>
                                        <option value="Manuten√ß√£o Preventiva">üîß Manuten√ß√£o Preventiva</option>
                                        <option value="Manuten√ß√£o Corretiva">‚ö†Ô∏è Manuten√ß√£o Corretiva</option>
                                        <option value="Solicita√ß√£o Do Cliente">üë§ Solicita√ß√£o Do Cliente</option>
                                        <option value="Defeitos Em Geral">‚ùå Defeitos Em Geral</option>
                                        <option value="Outros Motivos">‚ùì Outros Motivos</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Defeito / Medidas Tomadas *</label>
                                    <textarea id="equipeDefeito" class="form-textarea" placeholder="Descreva o defeito encontrado e as medidas tomadas"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Placa Nova (se aplic√°vel)</label>
                                    <input type="text" id="equipePlacaNova" class="form-input" placeholder="AAA-0000 ou AAA0A00">
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <div class="form-group">
                                        <label class="form-label">Data/Hora IN√çCIO</label>
                                        <input type="datetime-local" id="equipeDataHoraTroca" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Data/Hora FIM</label>
                                        <input type="datetime-local" id="equipeDataHoraFimTroca" class="form-input">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Observa√ß√µes -->
                            <div class="form-group" style="margin-top: 1.5rem;">
                                <label class="form-label">Observa√ß√µes Adicionais</label>
                                <textarea id="equipeObservacoes" class="form-textarea" placeholder="Observa√ß√µes gerais sobre a equipe ou atividade"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('modalEquipe')">
                    ‚ùå Cancelar
                </button>
                <button type="submit" form="formEquipe" class="btn btn-success">
                    üíæ Salvar Equipe
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Visualizar Relat√≥rio -->
    <div class="modal" id="modalVisualizarRelatorio">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3 class="modal-title">üëÅÔ∏è Visualizar Relat√≥rio</h3>
                <button class="modal-close" onclick="closeModal('modalVisualizarRelatorio')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem; display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-info" onclick="copiarRelatorio()">
                        üìã Copiar Texto
                    </button>
                    <button class="btn btn-success" onclick="copiarWhatsApp()">
                        üì± Copiar WhatsApp
                    </button>
                </div>
                <div class="report-container" id="relatorioTexto">
                    <!-- Preenchido via JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('modalVisualizarRelatorio')">
                    ‚ùå Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Carregando...</div>
        </div>
    </div>

    <script>
        // SISTEMA DE RELAT√ìRIO DE TURNO - GRUPOGPS v4.0
        // Sistema completo em arquivo √∫nico com GitHub como banco de dados
        
        // Estado Global da Aplica√ß√£o
        let currentUser = null;
        let userLevel = 'user';
        let relatorios = [];
        let configuracoes = {};
        let currentStep = 1;
        let currentRelatorio = {
            dadosTurno: {},
            equipes: []
        };
        
        // Controles do sistema
        let isOnline = navigator.onLine;
        let autoRefreshTimer = null;
        
        // Configura√ß√£o GitHub
        const GITHUB_CONFIG = {
            owner: 'GrupoGps-Mecanizada',
            repo: 'Sistema-Relatorio-Turno',
            branch: 'main',
            token: null,
            paths: {
                relatorios: 'data/relatorios.json',
                configuracoes: 'data/configuracoes.json'
            }
        };

        // Usu√°rios padr√£o do sistema
        const DEFAULT_USERS = {
            'admin': { 
                password: '123456', 
                level: 'admin', 
                name: 'Administrador',
                active: true
            },
            'supervisor': { 
                password: '123', 
                level: 'user', 
                name: 'Supervisor',
                active: true
            }
        };

        // Dados padr√£o do sistema
        const DEFAULT_DATA = {
            equipesNumeros: {
                'Alta Press√£o': ['AP-01', 'AP-02', 'AP-03', 'AP-04', 'AP-05'],
                'Auto V√°cuo / Hiper V√°cuo': ['AV-01', 'AV-02', 'AV-03', 'HV-01', 'HV-02']
            },
            vagas: [
                'V-01', 'V-02', 'V-03', 'V-04', 'V-05', 'V-06', 'V-07', 'V-08', 'V-09', 'V-10',
                'V-11', 'V-12', 'V-13', 'V-14', 'V-15', 'V-16', 'V-17', 'V-18', 'V-19', 'V-20'
            ],
            equipamentos: {
                'Alta Press√£o': ['Equip. AP-1000', 'Equip. AP-2000', 'Equip. AP-3000'],
                'Auto V√°cuo / Hiper V√°cuo': ['Equip. AV-500', 'Equip. AV-1000', 'Equip. HV-2000']
            }
        };

        // INICIALIZA√á√ÉO DO SISTEMA
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Sistema de Relat√≥rio de Turno - GrupoGPS v4.0');
            console.log('üì° GitHub como banco de dados √∫nico');
            
            // Verificar token de configura√ß√£o
            const savedToken = localStorage.getItem('grupogps_relatorio_githubToken');
            if (savedToken) {
                GITHUB_CONFIG.token = savedToken;
            }
            
            // Tentar restaurar sess√£o do usu√°rio
            const savedUser = localStorage.getItem('grupogps_relatorio_currentUser');
            if (savedUser && GITHUB_CONFIG.token) {
                try {
                    const userData = JSON.parse(savedUser);
                    await loginUser(userData.username, userData.level, userData.name);
                } catch (error) {
                    console.error('Erro no login autom√°tico:', error);
                    localStorage.removeItem('grupogps_relatorio_currentUser');
                    showNotification('Erro ao restaurar sess√£o. Fa√ßa login novamente.', 'warning');
                }
            }

            // Configurar event listeners
            setupEventListeners();
            
            // Configurar data padr√£o
            setupDefaultDate();
            
            // Monitoramento de conectividade
            setupNetworkMonitoring();
        });

        function setupEventListeners() {
            // Fechar modais ao clicar fora
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('show');
                }
            });

            // Atalhos de teclado
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.show').forEach(modal => {
                        modal.classList.remove('show');
                    });
                }
            });
        }

        function setupDefaultDate() {
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataTurno').value = hoje;
        }

        function setupNetworkMonitoring() {
            window.addEventListener('online', () => {
                isOnline = true;
                updateSyncStatus('success', 'Conectado');
                showNotification('Conex√£o restaurada! Sincronizando dados...', 'success');
                if (GITHUB_CONFIG.token) {
                    loadAllDataFromGitHub();
                }
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                updateSyncStatus('error', 'Offline');
                showNotification('Sem conex√£o. Trabalhando offline.', 'warning');
            });
        }

        // SISTEMA DE LOGIN
        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUser').value.toLowerCase().trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showNotification('Preencha usu√°rio e senha!', 'warning');
                return;
            }

            // Login de emerg√™ncia para configurar o token
            if (username === 'setup' && password === 'gps@2025') {
                enterSetupMode();
                return;
            }

            // Se n√£o h√° token, n√£o pode continuar, exceto para o setup
            if (!GITHUB_CONFIG.token) {
                showNotification('Token do GitHub n√£o configurado. Use o login "setup" para configurar.', 'error');
                return;
            }
            
            // Verificar usu√°rios padr√£o
            if (DEFAULT_USERS[username] && DEFAULT_USERS[username].password === password) {
                if (DEFAULT_USERS[username].active !== false) {
                    await loginUser(username, DEFAULT_USERS[username].level, DEFAULT_USERS[username].name);
                    return;
                } else {
                    showNotification('Usu√°rio inativo!', 'error');
                    return;
                }
            }
            
            showNotification('Usu√°rio ou senha incorretos!', 'error');
        }

        function enterSetupMode() {
            console.warn('‚ö†Ô∏è Entrando em Modo de Configura√ß√£o');
            showNotification('Modo de Configura√ß√£o: Configure o token do GitHub.', 'warning');

            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'flex';
            
            document.getElementById('currentUser').textContent = 'Modo Setup';
            document.getElementById('userLevel').textContent = 'Configura√ß√£o';
            
            // For√ßar aba de configura√ß√µes
            switchTab('configuracoes');
            
            // Mostrar instru√ß√µes e bot√£o de inicializa√ß√£o
            document.getElementById('setupInstruction').classList.remove('hidden');
            document.getElementById('btnInitializeSystem').classList.remove('hidden');
        }

        async function loginUser(username, level, name) {
            currentUser = username;
            userLevel = level;
            
            // Salvar sess√£o do usu√°rio
            localStorage.setItem('grupogps_relatorio_currentUser', JSON.stringify({
                username, level, name
            }));
            
            // Mostrar loading
            showLoading('Carregando dados do sistema...');
            
            try {
                // Carregar dados do GitHub
                if (GITHUB_CONFIG.token) {
                    await loadAllDataFromGitHub();
                }
                
                // Configurar interface
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'flex';
                document.getElementById('currentUser').textContent = name;
                document.getElementById('userLevel').textContent = 
                    level === 'admin' ? 'Admin' : 'Supervisor';
                
                // Inicializar interface
                initializeInterface();
                
                // Iniciar atualiza√ß√£o autom√°tica
                startAutoRefresh();
                
                hideLoading();
                showNotification(`Bem-vindo, ${name}!`, 'success');
                
            } catch (error) {
                hideLoading();
                console.error('Erro no login:', error);
                showNotification('Erro ao carregar dados. Verifique sua conex√£o e token.', 'error');
            }
        }

        function logout() {
            if (autoRefreshTimer) {
                clearInterval(autoRefreshTimer);
            }
            localStorage.removeItem('grupogps_relatorio_currentUser');
            location.reload();
        }

        // CARREGAMENTO DE DADOS
        async function loadAllDataFromGitHub() {
            if (!GITHUB_CONFIG.token) {
                throw new Error('Token do GitHub n√£o configurado');
            }
            
            updateSyncStatus('loading', 'Carregando dados...');
            
            try {
                const [
                    relatoriosData,
                    configuracoesData
                ] = await Promise.all([
                    getDataFromGitHub('relatorios'),
                    getDataFromGitHub('configuracoes')
                ]);
                
                relatorios = Array.isArray(relatoriosData) ? relatoriosData : [];
                configuracoes = (configuracoesData && typeof configuracoesData === 'object') ? configuracoesData : {};
                
                updateSyncStatus('success', 'Dados atualizados');
                updateInterface();
                
                console.log('‚úÖ Dados carregados do GitHub:', {
                    relatorios: relatorios.length,
                    configuracoes: Object.keys(configuracoes).length
                });
                
            } catch (error) {
                updateSyncStatus('error', 'Erro ao carregar');
                console.error('Erro ao carregar dados:', error);
                throw error;
            }
        }

        async function getDataFromGitHub(dataType) {
            const path = GITHUB_CONFIG.paths[dataType];
            
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                    headers: { 
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Accept': 'application/vnd.github.v3+json' 
                    }
                });

                if (response.ok) {
                    const fileData = await response.json();
                    const content = atob(fileData.content);
                    return JSON.parse(content);
                } else if (response.status === 404) {
                    console.warn(`Arquivo ${path} n√£o encontrado. Ser√° criado na pr√≥xima salva√ß√£o.`);
                    return null;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error(`Erro ao buscar ${dataType}:`, error);
                return null;
            }
        }

        async function saveDataToGitHub(dataType, data) {
            if (!GITHUB_CONFIG.token || !isOnline) {
                throw new Error('Sem conex√£o ou token n√£o configurado');
            }
            
            const path = GITHUB_CONFIG.paths[dataType];
            
            try {
                // Obter SHA atual do arquivo
                let sha = null;
                const getResponse = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                    headers: { 
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Accept': 'application/vnd.github.v3+json' 
                    }
                });

                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                }

                // Preparar dados com metadados
                const dataToSave = {
                    ...data,
                    _lastUpdate: new Date().toISOString(),
                    _updatedBy: currentUser
                };

                const jsonContent = JSON.stringify(dataToSave, null, 2);
                const base64Content = btoa(unescape(encodeURIComponent(jsonContent)));
                
                const body = {
                    message: `${sha ? 'Atualizar' : 'Criar'} ${dataType} - ${new Date().toLocaleString('pt-BR')}`,
                    content: base64Content,
                    branch: GITHUB_CONFIG.branch
                };
                
                if (sha) {
                    body.sha = sha;
                }

                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                    method: 'PUT',
                    headers: { 
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify(body)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: response.statusText }));
                    throw new Error(`Erro ${response.status}: ${errorData.message}`);
                }
                
                console.log(`‚úÖ ${dataType} salvo no GitHub`);
                return await response.json();

            } catch (error) {
                console.error(`Erro ao salvar ${dataType}:`, error);
                throw error;
            }
        }

        // NAVEGA√á√ÉO ENTRE ETAPAS
        function nextStep() {
            if (currentStep === 1) {
                if (validateStep1()) {
                    saveStepData(1);
                    showStep(2);
                }
            } else if (currentStep === 2) {
                if (validateStep2()) {
                    showStep(3);
                    generateReview();
                }
            }
        }

        function prevStep() {
            if (currentStep === 2) {
                showStep(1);
            } else if (currentStep === 3) {
                showStep(2);
            }
        }

        function showStep(step) {
            // Ocultar todas as etapas
            document.querySelectorAll('.step-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Mostrar etapa atual
            document.getElementById(`etapa${step}`).style.display = 'block';
            
            // Atualizar indicador
            updateStepIndicator(step);
            
            currentStep = step;
        }

        function updateStepIndicator(step) {
            document.querySelectorAll('.step-item').forEach((item, index) => {
                item.classList.remove('active', 'completed');
                if (index + 1 < step) {
                    item.classList.add('completed');
                } else if (index + 1 === step) {
                    item.classList.add('active');
                }
            });
        }

        function validateStep1() {
            const data = document.getElementById('dataTurno').value;
            const horario = document.getElementById('horarioTurno').value;
            const letra = document.getElementById('letraTurno').value;
            const supervisor = document.getElementById('supervisorTurno').value;
            
            if (!data || !horario || !letra || !supervisor) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'warning');
                return false;
            }
            
            return true;
        }

        function validateStep2() {
            if (currentRelatorio.equipes.length === 0) {
                showNotification('Adicione pelo menos uma equipe!', 'warning');
                return false;
            }
            return true;
        }

        function saveStepData(step) {
            if (step === 1) {
                currentRelatorio.dadosTurno = {
                    data: document.getElementById('dataTurno').value,
                    horario: document.getElementById('horarioTurno').value,
                    letra: document.getElementById('letraTurno').value,
                    supervisor: document.getElementById('supervisorTurno').value
                };
            }
        }

        // GEST√ÉO DE EQUIPES
        function adicionarEquipe(tipo) {
            document.getElementById('modalEquipeTitle').textContent = `Adicionar Equipe - ${tipo}`;
            document.getElementById('equipeTipo').value = tipo;
            document.getElementById('equipeIndex').value = '-1';
            
            // Preencher op√ß√µes baseadas no tipo
            populateEquipeOptions(tipo);
            
            // Limpar formul√°rio
            clearEquipeForm();
            
            document.getElementById('modalEquipe').classList.add('show');
        }

        function populateEquipeOptions(tipo) {
            const numeroSelect = document.getElementById('equipeNumero');
            const equipamentoSelect = document.getElementById('equipeEquipamento');
            const vagaSelect = document.getElementById('equipeVaga');
            
            // N√∫meros de equipe
            numeroSelect.innerHTML = '<option value="">Selecione...</option>';
            DEFAULT_DATA.equipesNumeros[tipo].forEach(numero => {
                numeroSelect.innerHTML += `<option value="${numero}">${numero}</option>`;
            });
            
            // Equipamentos
            equipamentoSelect.innerHTML = '<option value="">Selecione...</option>';
            DEFAULT_DATA.equipamentos[tipo].forEach(equipamento => {
                equipamentoSelect.innerHTML += `<option value="${equipamento}">${equipamento}</option>`;
            });
            
            // Vagas
            vagaSelect.innerHTML = '<option value="">Selecione...</option>';
            DEFAULT_DATA.vagas.forEach(vaga => {
                vagaSelect.innerHTML += `<option value="${vaga}">${vaga}</option>`;
            });
        }

        function clearEquipeForm() {
            document.getElementById('formEquipe').reset();
            document.getElementById('pendenciaContainer').classList.add('hidden');
            document.getElementById('trocaDetalhes').classList.add('hidden');
        }

        function togglePendencia() {
            const status = document.getElementById('equipeStatusAtividade').value;
            const container = document.getElementById('pendenciaContainer');
            
            if (status === 'Conclu√≠do') {
                container.classList.add('hidden');
            } else {
                container.classList.remove('hidden');
                document.getElementById('equipePendencia').required = true;
            }
        }

        function toggleTrocaEquipamento() {
            const troca = document.querySelector('input[name="equipeTroca"]:checked').value;
            const container = document.getElementById('trocaDetalhes');
            
            if (troca === 'Sim') {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
            }
        }

        function salvarEquipe(event) {
            event.preventDefault();
            
            if (!validateEquipeForm()) {
                return;
            }
            
            const equipeData = collectEquipeData();
            const index = parseInt(document.getElementById('equipeIndex').value);
            
            if (index === -1) {
                // Nova equipe
                currentRelatorio.equipes.push(equipeData);
            } else {
                // Editar equipe
                currentRelatorio.equipes[index] = equipeData;
            }
            
            updateTeamsDisplay();
            closeModal('modalEquipe');
            showNotification('Equipe salva com sucesso!', 'success');
        }

        function validateEquipeForm() {
            const required = document.querySelectorAll('#formEquipe [required]');
            let valid = true;
            
            required.forEach(field => {
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--danger-color)';
                    valid = false;
                } else {
                    field.style.borderColor = 'var(--gray-200)';
                }
            });
            
            if (!valid) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'warning');
            }
            
            return valid;
        }

        function collectEquipeData() {
            const trocaEquipamento = document.querySelector('input[name="equipeTroca"]:checked').value === 'Sim';
            
            const equipeData = {
                tipo: document.getElementById('equipeTipo').value,
                numero: document.getElementById('equipeNumero').value,
                motorista: document.getElementById('equipeMotorista').value,
                operadores: document.getElementById('equipeOperadores').value,
                area: document.getElementById('equipeArea').value,
                atividade: document.getElementById('equipeAtividade').value,
                tipoAtividade: document.getElementById('equipeTipoAtividade').value,
                statusAtividade: document.getElementById('equipeStatusAtividade').value,
                pendencia: document.getElementById('equipePendencia').value,
                vaga: document.getElementById('equipeVaga').value,
                equipamento: document.getElementById('equipeEquipamento').value,
                identificacaoUsiminas: document.getElementById('equipeIdentificacaoUsiminas').value,
                trocaEquipamento: trocaEquipamento,
                observacoes: document.getElementById('equipeObservacoes').value
            };
            
            if (trocaEquipamento) {
                equipeData.trocaDetalhes = {
                    motivo: document.getElementById('equipeMotivoTroca').value,
                    defeito: document.getElementById('equipeDefeito').value,
                    placaNova: document.getElementById('equipePlacaNova').value,
                    dataHoraInicio: document.getElementById('equipeDataHoraTroca').value,
                    dataHoraFim: document.getElementById('equipeDataHoraFimTroca').value
                };
            }
            
            return equipeData;
        }

        function updateTeamsDisplay() {
            const container = document.getElementById('teamsContainer');
            const btnProximo = document.getElementById('btnProximoRevisao');
            
            if (currentRelatorio.equipes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <h3>Nenhuma equipe adicionada</h3>
                        <p>Clique nos bot√µes acima para adicionar equipes ao relat√≥rio</p>
                    </div>
                `;
                btnProximo.disabled = true;
            } else {
                container.innerHTML = currentRelatorio.equipes.map((equipe, index) => `
                    <div class="team-card ${equipe.tipo.includes('Alta') ? 'alta-pressao' : 'vacuo'}">
                        <div class="team-header">
                            <div class="team-info">
                                <h3>${equipe.numero} - ${equipe.tipo}</h3>
                                <p>Motorista: ${equipe.motorista} | √Årea: ${equipe.area}</p>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-sm btn-info" onclick="editarEquipe(${index})">
                                    ‚úèÔ∏è Editar
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="removerEquipe(${index})">
                                    üóëÔ∏è Remover
                                </button>
                            </div>
                        </div>
                        <div class="team-content">
                            <div class="team-details">
                                <div class="detail-item">
                                    <div class="detail-label">Operadores</div>
                                    <div class="detail-value">${equipe.operadores}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Atividade</div>
                                    <div class="detail-value">${equipe.atividade}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Tipo</div>
                                    <div class="detail-value">
                                        <span class="badge badge-info">${equipe.tipoAtividade}</span>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Status</div>
                                    <div class="detail-value">
                                        <span class="badge badge-${equipe.statusAtividade === 'Conclu√≠do' ? 'success' : 'warning'}">${equipe.statusAtividade}</span>
                                    </div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Equipamento</div>
                                    <div class="detail-value">${equipe.equipamento}</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">Vaga</div>
                                    <div class="detail-value">${equipe.vaga}</div>
                                </div>
                            </div>
                            ${equipe.pendencia ? `
                                <div style="margin-top: 1rem; padding: 1rem; background: var(--warning-color); color: white; border-radius: 8px;">
                                    <strong>‚ö†Ô∏è Pend√™ncia:</strong> ${equipe.pendencia}
                                </div>
                            ` : ''}
                            ${equipe.trocaEquipamento ? `
                                <div style="margin-top: 1rem; padding: 1rem; background: var(--info-color); color: white; border-radius: 8px;">
                                    <strong>üîß Troca de Equipamento:</strong> ${equipe.trocaDetalhes?.motivo || 'Sim'}
                                </div>
                            ` : ''}
                            ${equipe.observacoes ? `
                                <div style="margin-top: 1rem; padding: 1rem; background: var(--gray-100); border-radius: 8px;">
                                    <strong>üìù Observa√ß√µes:</strong> ${equipe.observacoes}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
                btnProximo.disabled = false;
            }
        }

        function editarEquipe(index) {
            const equipe = currentRelatorio.equipes[index];
            
            document.getElementById('modalEquipeTitle').textContent = `Editar Equipe - ${equipe.tipo}`;
            document.getElementById('equipeTipo').value = equipe.tipo;
            document.getElementById('equipeIndex').value = index;
            
            // Preencher op√ß√µes
            populateEquipeOptions(equipe.tipo);
            
            // Preencher dados
            setTimeout(() => {
                document.getElementById('equipeNumero').value = equipe.numero;
                document.getElementById('equipeMotorista').value = equipe.motorista;
                document.getElementById('equipeOperadores').value = equipe.operadores;
                document.getElementById('equipeArea').value = equipe.area;
                document.getElementById('equipeAtividade').value = equipe.atividade;
                document.getElementById('equipeTipoAtividade').value = equipe.tipoAtividade;
                document.getElementById('equipeStatusAtividade').value = equipe.statusAtividade;
                document.getElementById('equipePendencia').value = equipe.pendencia || '';
                document.getElementById('equipeVaga').value = equipe.vaga;
                document.getElementById('equipeEquipamento').value = equipe.equipamento;
                document.getElementById('equipeIdentificacaoUsiminas').value = equipe.identificacaoUsiminas || '';
                document.getElementById('equipeObservacoes').value = equipe.observacoes || '';
                
                // Configurar troca de equipamento
                if (equipe.trocaEquipamento) {
                    document.getElementById('equipeTrocaSim').checked = true;
                    toggleTrocaEquipamento();
                    
                    if (equipe.trocaDetalhes) {
                        document.getElementById('equipeMotivoTroca').value = equipe.trocaDetalhes.motivo || '';
                        document.getElementById('equipeDefeito').value = equipe.trocaDetalhes.defeito || '';
                        document.getElementById('equipePlacaNova').value = equipe.trocaDetalhes.placaNova || '';
                        document.getElementById('equipeDataHoraTroca').value = equipe.trocaDetalhes.dataHoraInicio || '';
                        document.getElementById('equipeDataHoraFimTroca').value = equipe.trocaDetalhes.dataHoraFim || '';
                    }
                } else {
                    document.getElementById('equipeTrocaNao').checked = true;
                }
                
                // Configurar pend√™ncia
                togglePendencia();
            }, 100);
            
            document.getElementById('modalEquipe').classList.add('show');
        }

        function removerEquipe(index) {
            if (confirm('Tem certeza que deseja remover esta equipe?')) {
                currentRelatorio.equipes.splice(index, 1);
                updateTeamsDisplay();
                showNotification('Equipe removida!', 'info');
            }
        }

        // REVIS√ÉO E FINALIZA√á√ÉO
        function generateReview() {
            const resumoTurno = document.getElementById('resumoTurno');
            const resumoEquipes = document.getElementById('resumoEquipes');
            
            // Resumo do turno
            resumoTurno.innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">Data</div>
                    <div class="detail-value">${formatarData(currentRelatorio.dadosTurno.data)}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Hor√°rio</div>
                    <div class="detail-value">${currentRelatorio.dadosTurno.horario}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Letra</div>
                    <div class="detail-value">${currentRelatorio.dadosTurno.letra}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Supervisor</div>
                    <div class="detail-value">${currentRelatorio.dadosTurno.supervisor}</div>
                </div>
            `;
            
            // Resumo das equipes
            const totalEquipes = currentRelatorio.equipes.length;
            const equipesAltaPressao = currentRelatorio.equipes.filter(e => e.tipo.includes('Alta')).length;
            const equipesVacuo = currentRelatorio.equipes.filter(e => e.tipo.includes('V√°cuo')).length;
            const atividadesConcluidas = currentRelatorio.equipes.filter(e => e.statusAtividade === 'Conclu√≠do').length;
            const trocasEquipamento = currentRelatorio.equipes.filter(e => e.trocaEquipamento).length;
            
            resumoEquipes.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${totalEquipes}</div>
                        <div class="stat-label">Total de Equipes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${equipesAltaPressao}</div>
                        <div class="stat-label">Alta Press√£o</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${equipesVacuo}</div>
                        <div class="stat-label">V√°cuo/Hiper</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${atividadesConcluidas}</div>
                        <div class="stat-label">Conclu√≠das</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${trocasEquipamento}</div>
                        <div class="stat-label">Trocas de Equipamento</div>
                    </div>
                </div>
            `;
        }

        async function salvarRelatorio() {
            showLoading('Salvando relat√≥rio...');
            
            try {
                // Gerar ID √∫nico
                const relatorioId = `REL${Date.now()}`;
                
                // Preparar dados do relat√≥rio
                const relatorio = {
                    id: relatorioId,
                    dadosTurno: currentRelatorio.dadosTurno,
                    equipes: currentRelatorio.equipes,
                    estatisticas: {
                        totalEquipes: currentRelatorio.equipes.length,
                        equipesAltaPressao: currentRelatorio.equipes.filter(e => e.tipo.includes('Alta')).length,
                        equipesVacuo: currentRelatorio.equipes.filter(e => e.tipo.includes('V√°cuo')).length,
                        atividadesConcluidas: currentRelatorio.equipes.filter(e => e.statusAtividade === 'Conclu√≠do').length,
                        trocasEquipamento: currentRelatorio.equipes.filter(e => e.trocaEquipamento).length
                    },
                    criadoPor: currentUser,
                    criadoEm: new Date().toISOString()
                };
                
                // Carregar dados atuais e adicionar novo relat√≥rio
                if (GITHUB_CONFIG.token) {
                    await loadAllDataFromGitHub();
                }
                
                relatorios.unshift(relatorio);
                
                // Salvar no GitHub
                if (GITHUB_CONFIG.token) {
                    await saveDataToGitHub('relatorios', relatorios);
                }
                
                // Salvar localmente como backup
                localStorage.setItem('grupogps_relatorio_backup', JSON.stringify(relatorios));
                
                // Mostrar sucesso
                document.getElementById('relatorioIdDisplay').textContent = relatorioId;
                showStep(4);
                
                // Atualizar interface
                updateInterface();
                
                hideLoading();
                showNotification('Relat√≥rio salvo com sucesso!', 'success');
                
            } catch (error) {
                hideLoading();
                console.error('Erro ao salvar relat√≥rio:', error);
                
                // Tentar salvar localmente
                try {
                    const localRelatorios = JSON.parse(localStorage.getItem('grupogps_relatorio_backup') || '[]');
                    const relatorioLocal = {
                        id: `LOCAL${Date.now()}`,
                        dadosTurno: currentRelatorio.dadosTurno,
                        equipes: currentRelatorio.equipes,
                        salvoLocalmente: true,
                        criadoPor: currentUser,
                        criadoEm: new Date().toISOString()
                    };
                    localRelatorios.unshift(relatorioLocal);
                    localStorage.setItem('grupogps_relatorio_backup', JSON.stringify(localRelatorios));
                    
                    document.getElementById('relatorioIdDisplay').textContent = relatorioLocal.id + ' (Local)';
                    showStep(4);
                    showNotification('Relat√≥rio salvo localmente. Ser√° sincronizado quando houver conex√£o.', 'warning');
                } catch (localError) {
                    showNotification('Erro ao salvar relat√≥rio: ' + error.message, 'error');
                }
            }
        }

        function novoRelatorio() {
            currentRelatorio = {
                dadosTurno: {},
                equipes: []
            };
            
            // Limpar formul√°rios
            document.getElementById('formEquipe').reset();
            
            // Configurar data padr√£o
            setupDefaultDate();
            
            // Voltar para primeira etapa
            showStep(1);
            
            // Limpar displays
            updateTeamsDisplay();
        }

        function visualizarRelatorio() {
            const relatorio = gerarTextoRelatorio();
            document.getElementById('relatorioTexto').textContent = relatorio;
            document.getElementById('modalVisualizarRelatorio').classList.add('show');
        }

        function formatarWhatsApp() {
            const relatorio = gerarTextoWhatsApp();
            
            navigator.clipboard.writeText(relatorio).then(() => {
                showNotification('Relat√≥rio formatado para WhatsApp copiado!', 'success');
            }).catch(() => {
                // Fallback para mostrar o texto
                document.getElementById('relatorioTexto').textContent = relatorio;
                document.getElementById('modalVisualizarRelatorio').classList.add('show');
                showNotification('Use Ctrl+A e Ctrl+C para copiar o relat√≥rio', 'info');
            });
        }

        function gerarTextoRelatorio() {
            const dados = currentRelatorio.dadosTurno;
            const equipes = currentRelatorio.equipes;
            
            let relatorio = `RELAT√ìRIO DE TURNO - GRUPOGPS\n`;
            relatorio += `${'='.repeat(50)}\n\n`;
            relatorio += `Data: ${formatarData(dados.data)}\n`;
            relatorio += `Hor√°rio: ${dados.horario}\n`;
            relatorio += `Letra do Turno: ${dados.letra}\n`;
            relatorio += `Supervisor: ${dados.supervisor}\n\n`;
            
            relatorio += `RESUMO GERAL:\n`;
            relatorio += `${'-'.repeat(30)}\n`;
            relatorio += `Total de Equipes: ${equipes.length}\n`;
            relatorio += `Equipes Alta Press√£o: ${equipes.filter(e => e.tipo.includes('Alta')).length}\n`;
            relatorio += `Equipes V√°cuo/Hiper: ${equipes.filter(e => e.tipo.includes('V√°cuo')).length}\n`;
            relatorio += `Atividades Conclu√≠das: ${equipes.filter(e => e.statusAtividade === 'Conclu√≠do').length}\n`;
            relatorio += `Trocas de Equipamento: ${equipes.filter(e => e.trocaEquipamento).length}\n\n`;
            
            relatorio += `DETALHES DAS EQUIPES:\n`;
            relatorio += `${'='.repeat(50)}\n\n`;
            
            equipes.forEach((equipe, index) => {
                relatorio += `${index + 1}. EQUIPE ${equipe.numero} - ${equipe.tipo.toUpperCase()}\n`;
                relatorio += `${'-'.repeat(40)}\n`;
                relatorio += `Motorista: ${equipe.motorista}\n`;
                relatorio += `Operadores: ${equipe.operadores}\n`;
                relatorio += `√Årea de Atua√ß√£o: ${equipe.area}\n`;
                relatorio += `Atividade: ${equipe.atividade}\n`;
                relatorio += `Tipo: ${equipe.tipoAtividade}\n`;
                relatorio += `Status: ${equipe.statusAtividade}\n`;
                
                if (equipe.pendencia) {
                    relatorio += `PEND√äNCIA: ${equipe.pendencia}\n`;
                }
                
                relatorio += `Vaga: ${equipe.vaga}\n`;
                relatorio += `Equipamento: ${equipe.equipamento}\n`;
                
                if (equipe.identificacaoUsiminas) {
                    relatorio += `ID Usiminas: ${equipe.identificacaoUsiminas}\n`;
                }
                
                if (equipe.trocaEquipamento) {
                    relatorio += `\nTROCA DE EQUIPAMENTO:\n`;
                    relatorio += `Motivo: ${equipe.trocaDetalhes?.motivo || 'N√£o informado'}\n`;
                    if (equipe.trocaDetalhes?.defeito) {
                        relatorio += `Defeito/Medidas: ${equipe.trocaDetalhes.defeito}\n`;
                    }
                    if (equipe.trocaDetalhes?.placaNova) {
                        relatorio += `Nova Placa: ${equipe.trocaDetalhes.placaNova}\n`;
                    }
                    if (equipe.trocaDetalhes?.dataHoraInicio) {
                        relatorio += `In√≠cio: ${formatarDataHora(equipe.trocaDetalhes.dataHoraInicio)}\n`;
                    }
                    if (equipe.trocaDetalhes?.dataHoraFim) {
                        relatorio += `Fim: ${formatarDataHora(equipe.trocaDetalhes.dataHoraFim)}\n`;
                    }
                }
                
                if (equipe.observacoes) {
                    relatorio += `\nObserva√ß√µes: ${equipe.observacoes}\n`;
                }
                
                relatorio += `\n`;
            });
            
            relatorio += `${'='.repeat(50)}\n`;
            relatorio += `Relat√≥rio gerado em: ${new Date().toLocaleString('pt-BR')}\n`;
            relatorio += `Sistema: GrupoGPS - Relat√≥rio de Turno v4.0\n`;
            
            return relatorio;
        }

        function gerarTextoWhatsApp() {
            const dados = currentRelatorio.dadosTurno;
            const equipes = currentRelatorio.equipes;
            
            let relatorio = `*üöõ RELAT√ìRIO DE TURNO - GRUPOGPS*\n`;
            relatorio += `üìÖ *${formatarData(dados.data)} - ${dados.horario}*\n`;
            relatorio += `üî§ Turno: *${dados.letra}* | üë§ Supervisor: *${dados.supervisor}*\n`;
            relatorio += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
            
            equipes.forEach((equipe, index) => {
                const statusIcon = equipe.statusAtividade === 'Conclu√≠do' ? '‚úÖ' : 
                                 equipe.statusAtividade === 'Em andamento' ? 'üîÑ' : '‚è∏Ô∏è';
                const tipoIcon = equipe.tipo.includes('Alta') ? 'üîß' : 'üöÄ';
                
                relatorio += `*${index + 1}. ${tipoIcon} ${equipe.numero}*\n`;
                relatorio += `üë§ ${equipe.motorista} | ${equipe.operadores}\n`;
                relatorio += `üìç ${equipe.area}\n`;
                relatorio += `‚öôÔ∏è ${equipe.atividade}\n`;
                relatorio += `${statusIcon} ${equipe.statusAtividade}`;
                
                if (equipe.pendencia) {
                    relatorio += `\n‚ö†Ô∏è *Pend√™ncia:* ${equipe.pendencia}`;
                }
                
                if (equipe.trocaEquipamento) {
                    relatorio += `\nüîß *Troca de Equipamento*`;
                    if (equipe.trocaDetalhes?.motivo) {
                        relatorio += ` - ${equipe.trocaDetalhes.motivo}`;
                    }
                }
                
                relatorio += `\n\n`;
            });
            
            relatorio += `üìä *RESUMO:*\n`;
            relatorio += `üë• Total: ${equipes.length} equipes\n`;
            relatorio += `‚úÖ Conclu√≠das: ${equipes.filter(e => e.statusAtividade === 'Conclu√≠do').length}\n`;
            
            const trocas = equipes.filter(e => e.trocaEquipamento).length;
            if (trocas > 0) {
                relatorio += `üîß Trocas: ${trocas}\n`;
            }
            
            relatorio += `\n_Sistema GrupoGPS v4.0_`;
            
            return relatorio;
        }

        function copiarRelatorio() {
            const texto = document.getElementById('relatorioTexto').textContent;
            navigator.clipboard.writeText(texto).then(() => {
                showNotification('Relat√≥rio copiado para a √°rea de transfer√™ncia!', 'success');
            });
        }

        function copiarWhatsApp() {
            const relatorio = gerarTextoWhatsApp();
            navigator.clipboard.writeText(relatorio).then(() => {
                showNotification('Relat√≥rio formatado para WhatsApp copiado!', 'success');
            });
        }

        // NAVEGA√á√ÉO ENTRE ABAS
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tabName}')"]`)?.classList.add('active');
            document.getElementById(tabName + '-tab')?.classList.add('active');
            
            // Atualizar dados ao trocar de aba
            if (tabName === 'relatorios' || tabName === 'dashboard') {
                updateInterface();
            }
        }

        // PESQUISA
        function ajustarCampoPesquisa() {
            const tipo = document.getElementById('tipoPesquisa').value;
            
            // Ocultar todos os campos
            document.querySelectorAll('[id^="campoPesquisa"]').forEach(campo => {
                campo.classList.add('hidden');
            });
            
            // Mostrar campo apropriado
            if (tipo === 'data') {
                document.getElementById('campoPesquisaData').classList.remove('hidden');
            } else if (tipo === 'periodo') {
                document.getElementById('campoPesquisaPeriodo').classList.remove('hidden');
                document.getElementById('campoPesquisaPeriodoFim').classList.remove('hidden');
            } else {
                document.getElementById('campoPesquisaGeral').classList.remove('hidden');
            }
        }

        function executarPesquisa() {
            const tipo = document.getElementById('tipoPesquisa').value;
            let resultados = [];
            
            if (tipo === 'data') {
                const data = document.getElementById('dataPesquisa').value;
                resultados = relatorios.filter(r => r.dadosTurno.data === data);
            } else if (tipo === 'periodo') {
                const dataInicial = document.getElementById('dataInicialPesquisa').value;
                const dataFinal = document.getElementById('dataFinalPesquisa').value;
                resultados = relatorios.filter(r => 
                    r.dadosTurno.data >= dataInicial && r.dadosTurno.data <= dataFinal
                );
            } else {
                const termo = document.getElementById('termoPesquisa').value.toLowerCase();
                resultados = relatorios.filter(r => 
                    r.id.toLowerCase().includes(termo) ||
                    r.dadosTurno.supervisor.toLowerCase().includes(termo) ||
                    r.dadosTurno.letra.toLowerCase().includes(termo)
                );
            }
            
            mostrarResultadosPesquisa(resultados);
        }

        function mostrarResultadosPesquisa(resultados) {
            const container = document.getElementById('resultadosPesquisa');
            const tbody = document.getElementById('pesquisaTableBody');
            
            if (resultados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7">
                            <div class="empty-state">
                                <div class="empty-state-icon">üîç</div>
                                <h3>Nenhum resultado encontrado</h3>
                                <p>Tente ajustar os crit√©rios de pesquisa</p>
                            </div>
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = resultados.map(relatorio => `
                    <tr>
                        <td>${relatorio.id}</td>
                        <td>${formatarData(relatorio.dadosTurno.data)}</td>
                        <td>${relatorio.dadosTurno.horario}</td>
                        <td>${relatorio.dadosTurno.letra}</td>
                        <td>${relatorio.dadosTurno.supervisor}</td>
                        <td>${relatorio.equipes.length}</td>
                        <td>
                            <button class="btn btn-sm btn-info" onclick="visualizarRelatorioSalvo('${relatorio.id}')">
                                üëÅÔ∏è Ver
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
            
            container.classList.remove('hidden');
        }

        function limparPesquisa() {
            document.getElementById('tipoPesquisa').value = 'geral';
            document.getElementById('termoPesquisa').value = '';
            document.getElementById('dataPesquisa').value = '';
            document.getElementById('dataInicialPesquisa').value = '';
            document.getElementById('dataFinalPesquisa').value = '';
            document.getElementById('resultadosPesquisa').classList.add('hidden');
            ajustarCampoPesquisa();
        }

        function visualizarRelatorioSalvo(id) {
            const relatorio = relatorios.find(r => r.id === id);
            if (!relatorio) return;
            
            // Temporariamente definir o relat√≥rio atual para gerar o texto
            const tempRelatorio = currentRelatorio;
            currentRelatorio = relatorio;
            
            const texto = gerarTextoRelatorio();
            document.getElementById('relatorioTexto').textContent = texto;
            document.getElementById('modalVisualizarRelatorio').classList.add('show');
            
            // Restaurar relat√≥rio atual
            currentRelatorio = tempRelatorio;
        }

        // INTERFACE E ESTAT√çSTICAS
        function initializeInterface() {
            updateInterface();
            loadConfiguracoes();
        }

        function updateInterface() {
            updateRelatoriosTable();
            updateStatistics();
        }

        function updateRelatoriosTable() {
            const tbody = document.getElementById('relatoriosTableBody');
            
            if (!Array.isArray(relatorios) || relatorios.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8">
                            <div class="empty-state">
                                <div class="empty-state-icon">üìã</div>
                                <h3>Nenhum relat√≥rio encontrado</h3>
                                <p>Crie seu primeiro relat√≥rio na aba "Novo Relat√≥rio"</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = relatorios.slice(0, 50).map(relatorio => `
                <tr>
                    <td>${relatorio.id}</td>
                    <td>${formatarData(relatorio.dadosTurno.data)}</td>
                    <td>${relatorio.dadosTurno.horario}</td>
                    <td>${relatorio.dadosTurno.letra}</td>
                    <td>${relatorio.dadosTurno.supervisor}</td>
                    <td>${relatorio.equipes.length}</td>
                    <td>
                        <span class="badge badge-${relatorio.salvoLocalmente ? 'warning' : 'success'}">
                            ${relatorio.salvoLocalmente ? 'Local' : 'Sincronizado'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-info" onclick="visualizarRelatorioSalvo('${relatorio.id}')">
                            üëÅÔ∏è Ver
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateStatistics() {
            if (!Array.isArray(relatorios)) return;
            
            const hoje = new Date().toISOString().split('T')[0];
            const relatoriosHoje = relatorios.filter(r => r.dadosTurno.data === hoje).length;
            const totalEquipes = relatorios.reduce((sum, r) => sum + r.equipes.length, 0);
            const atividadesConcluidas = relatorios.reduce((sum, r) => 
                sum + r.equipes.filter(e => e.statusAtividade === 'Conclu√≠do').length, 0
            );
            
            // Estat√≠sticas da aba Relat√≥rios
            document.getElementById('totalRelatorios').textContent = relatorios.length;
            document.getElementById('relatoriosHoje').textContent = relatoriosHoje;
            document.getElementById('equipesTotal').textContent = totalEquipes;
            document.getElementById('atividadesConcluidas').textContent = atividadesConcluidas;
            
            // Estat√≠sticas do Dashboard
            document.getElementById('dashTotalRelatorios').textContent = relatorios.length;
            document.getElementById('dashEquipesAtivas').textContent = totalEquipes;
            document.getElementById('dashAtividadesConcluidas').textContent = atividadesConcluidas;
            document.getElementById('dashTrocasEquipamento').textContent = 
                relatorios.reduce((sum, r) => sum + r.equipes.filter(e => e.trocaEquipamento).length, 0);
        }

        // CONFIGURA√á√ïES
        function salvarConfigGitHub() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                showNotification('Informe o token do GitHub!', 'warning');
                return;
            }
            
            GITHUB_CONFIG.token = token;
            localStorage.setItem('grupogps_relatorio_githubToken', token);
            
            showNotification('Token do GitHub salvo com sucesso!', 'success');
            document.getElementById('btnInitializeSystem').classList.remove('hidden');
            
            setTimeout(() => {
                testarConexaoGitHub();
            }, 500);
        }

        async function initializeSystemFiles() {
            if (!GITHUB_CONFIG.token) {
                showNotification('Por favor, insira e salve o token do GitHub primeiro.', 'error');
                return;
            }
            
            if (!confirm('Isso criar√° a estrutura de arquivos no reposit√≥rio. Continuar?')) {
                return;
            }

            showLoading('Inicializando arquivos no GitHub...');

            try {
                const initialData = {
                    relatorios: [],
                    configuracoes: {
                        nomeEmpresa: 'GrupoGPS',
                        autoRefreshInterval: 60,
                        autoBackup: true
                    }
                };

                await Promise.all(
                    Object.keys(GITHUB_CONFIG.paths).map(key => 
                        saveDataToGitHub(key, initialData[key])
                    )
                );

                hideLoading();
                showNotification('Sistema inicializado com sucesso! Recarregue a p√°gina.', 'success');
                setTimeout(() => location.reload(), 3000);

            } catch (error) {
                hideLoading();
                console.error('Erro ao inicializar o sistema:', error);
                showNotification('Erro ao inicializar: ' + error.message, 'error');
            }
        }

        function testarConexaoGitHub() {
            const token = document.getElementById('githubToken').value.trim() || 
                         GITHUB_CONFIG.token || 
                         localStorage.getItem('grupogps_relatorio_githubToken');
            
            if (!token) {
                showNotification('Informe o token primeiro!', 'warning');
                return;
            }
            
            showNotification('Testando conex√£o...', 'info');
            
            fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}`, {
                headers: { 
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json' 
                }
            })
            .then(response => {
                if (response.ok) { 
                    return response.json(); 
                } else { 
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`); 
                }
            })
            .then(data => {
                showNotification(`‚úÖ Conex√£o OK! Reposit√≥rio: ${data.full_name}`, 'success');
                GITHUB_CONFIG.token = token;
                localStorage.setItem('grupogps_relatorio_githubToken', token);
            })
            .catch(error => {
                console.error('Erro na conex√£o:', error);
                showNotification('‚ùå Erro na conex√£o: ' + error.message, 'error');
            });
        }

        function loadConfiguracoes() {
            try {
                const tokenSalvo = localStorage.getItem('grupogps_relatorio_githubToken');
                if (tokenSalvo) {
                    GITHUB_CONFIG.token = tokenSalvo;
                    const tokenField = document.getElementById('githubToken');
                    if (tokenField) { 
                        tokenField.value = tokenSalvo; 
                    }
                }
                
                if (configuracoes.nomeEmpresa) { 
                    document.getElementById('nomeEmpresa').value = configuracoes.nomeEmpresa; 
                }
                if (configuracoes.autoRefreshInterval) { 
                    document.getElementById('autoRefreshInterval').value = configuracoes.autoRefreshInterval; 
                }
                if (configuracoes.autoBackup !== undefined) { 
                    document.getElementById('autoBackup').value = configuracoes.autoBackup.toString(); 
                }
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
            }
        }

        async function salvarConfigGerais() {
            configuracoes.nomeEmpresa = document.getElementById('nomeEmpresa').value;
            configuracoes.autoRefreshInterval = parseInt(document.getElementById('autoRefreshInterval').value);
            configuracoes.autoBackup = document.getElementById('autoBackup').value === 'true';
            
            try {
                if (GITHUB_CONFIG.token) {
                    await saveDataToGitHub('configuracoes', configuracoes);
                }
                showNotification('Configura√ß√µes salvas!', 'success');
                startAutoRefresh();
            } catch (error) {
                console.error('Erro ao salvar configura√ß√µes:', error);
                showNotification('Erro ao salvar configura√ß√µes: ' + error.message, 'error');
            }
        }

        function resetarSistema() {
            if (confirm('ATEN√á√ÉO: Isso ir√° limpar os dados locais do navegador. Tem certeza?')) {
                if (confirm('Confirma a limpeza do cache local?')) {
                    localStorage.clear();
                    if (autoRefreshTimer) {
                        clearInterval(autoRefreshTimer);
                    }
                    location.reload();
                }
            }
        }

        // EXPORTA√á√ÉO
        function exportarRelatorios() {
            if (!relatorios || relatorios.length === 0) {
                showNotification('Nenhum relat√≥rio para exportar!', 'warning');
                return;
            }
            
            const dados = relatorios.map(r => ({
                'ID': r.id,
                'Data': formatarData(r.dadosTurno.data),
                'Hor√°rio': r.dadosTurno.horario,
                'Letra': r.dadosTurno.letra,
                'Supervisor': r.dadosTurno.supervisor,
                'Total Equipes': r.equipes.length,
                'Atividades Conclu√≠das': r.equipes.filter(e => e.statusAtividade === 'Conclu√≠do').length,
                'Trocas Equipamento': r.equipes.filter(e => e.trocaEquipamento).length,
                'Criado Por': r.criadoPor,
                'Criado Em': formatarDataHora(r.criadoEm)
            }));
            
            exportarCSV(dados, 'relatorios_turno');
        }

        function exportarCSV(dados, nomeArquivo) {
            const csvContent = "data:text/csv;charset=utf-8," 
                + Object.keys(dados[0]).join(",") + "\n"
                + dados.map(row => Object.values(row).join(",")).join("\n");

            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `${nomeArquivo}_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Arquivo exportado com sucesso!', 'success');
        }

        // ATUALIZA√á√ÉO AUTOM√ÅTICA
        function startAutoRefresh() {
            if (autoRefreshTimer) {
                clearInterval(autoRefreshTimer);
            }
            
            const interval = (configuracoes.autoRefreshInterval || 60) * 1000;
            autoRefreshTimer = setInterval(async () => {
                if (isOnline && GITHUB_CONFIG.token) {
                    try {
                        await loadAllDataFromGitHub();
                        console.log('üîÑ Dados atualizados automaticamente');
                    } catch (error) {
                        console.error('Erro na atualiza√ß√£o autom√°tica:', error);
                    }
                }
            }, interval);
        }

        async function forceRefresh() {
            if (!isOnline || !GITHUB_CONFIG.token) {
                showNotification('Sem conex√£o ou token n√£o configurado', 'warning');
                return;
            }
            
            showLoading('Atualizando dados do GitHub...');
            
            try {
                await loadAllDataFromGitHub();
                hideLoading();
                showNotification('Dados sincronizados com o GitHub!', 'success');
            } catch (error) {
                hideLoading();
                console.error('Erro ao atualizar dados:', error);
                showNotification('Erro ao sincronizar: ' + error.message, 'error');
            }
        }

        // FUN√á√ïES UTILIT√ÅRIAS
        function formatarData(dataISO) {
            if (!dataISO) return '-';
            const [ano, mes, dia] = dataISO.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        function formatarDataHora(isoString) {
            if (!isoString) return '-';
            const data = new Date(isoString);
            return data.toLocaleString('pt-BR', { hour12: false });
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => { 
                notification.remove(); 
            }, 4000);
        }

        function showLoading(message = 'Carregando...') {
            document.getElementById('loadingText').textContent = message;
            document.getElementById('loadingOverlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        function updateSyncStatus(status, message) {
            const dot = document.getElementById('syncDot');
            const statusText = document.getElementById('syncStatus');
            
            dot.className = 'sync-dot';
            if (status === 'loading') {
                dot.classList.add('loading');
            } else if (status === 'error') {
                dot.classList.add('error');
            }
            
            statusText.textContent = message;
        }

        console.log('üöÄ Sistema de Relat√≥rio de Turno - GrupoGPS v4.0 Carregado');
        console.log('üì° GitHub como banco de dados √∫nico');
        console.log('‚ú® Sistema simplificado e moderno pronto para uso');
    </script>
</body>
</html>
